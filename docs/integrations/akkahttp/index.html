<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Freestyle</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries" /><meta name="author" content="47 Degrees" /><meta name="og:image" content="/img/poster.png" /><meta name="og:title" content="Freestyle" /><meta name="og:site_name" content="Freestyle" /><meta name="og:url" content="https://47deg.github.io/docs/" /><meta name="og:type" content="website" /><meta name="og:description" content="A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><meta name="kazari-dependencies" content="com.47deg;freestyle_2.12;0.1.0-SNAPSHOT,org.scalamacros;paradise_2.12.1;2.1.0" /><meta name="kazari-resolvers" content="https://oss.sonatype.org/content/repositories/snapshots,https://oss.sonatype.org/content/repositories/releases" /><link rel="icon" type="image/png" href="/img/favicon.png" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/dracula.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><link rel="stylesheet" href="/css/kazari-style.css" /><link rel="stylesheet" href="/css/dracula.css" /><link rel="stylesheet" href="/css/custom.css" /><link rel="stylesheet" href="/css/dracula.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Freestyle</span></div></a></li> <li><a href="/docs/" class="">Quick Start</a></li> <li><a href="/" class="">Core Concepts</a> <ul class="sub_section"> <li><a href="/docs/core/algebras/" class="">Algebras</a></li> <li><a href="/docs/core/interpreters/" class="">Handlers</a></li> <li><a href="/docs/core/parallelism/" class="">Parallelism</a></li> <li><a href="/docs/core/modules/" class="">Modules</a></li></ul></li> <li><a href="/docs/effects/" class="">Effects</a> <ul class="sub_section"> <li><a href="/docs/effects/#errorm" class="">Error</a></li> <li><a href="/docs/effects/#eithermg" class="">Either</a></li> <li><a href="/docs/effects/#optionm" class="">Option</a></li> <li><a href="/docs/effects/#readerm" class="">Reader</a></li> <li><a href="/docs/effects/#writerm" class="">Writer</a></li> <li><a href="/docs/effects/#statem" class="">State</a></li> <li><a href="/docs/effects/#traversem" class="">Traverse</a></li> <li><a href="/docs/effects/#validationm" class="">Validation</a></li> <li><a href="/docs/effects/async" class="">Async Callbacks</a></li></ul></li> <li><a href="/docs/stack/" class="">Example Target Stack</a></li> <li><a href="/TODO.html" class="">Patterns</a> <ul class="sub_section"> <li><a href="/docs/effects/Cache/" class="">Cache</a></li> <li><a href="/TODO.html" class="">Dependency Injection</a></li> <li><a href="/docs/patterns/config" class="">Configuration</a></li> <li><a href="/docs/patterns/logging" class="">Logging</a></li></ul></li> <li><a href="/TODO.html" class="">Integrations</a> <ul class="sub_section"> <li><a href="/docs/cats" class="">Cats</a></li> <li><a href="/docs/play" class="">Play Framework</a></li> <li><a href="/TODO.html" class="">Monix</a></li> <li><a href="/docs/fetch" class="">Fetch</a></li> <li><a href="/docs/fs2" class="">FS2</a></li> <li><a href="/docs/doobie" class="">Doobie</a></li> <li><a href="/docs/slick" class="">Slick</a></li> <li><a href="/docs/integrations/akkahttp" class=" active ">Akka HTTP</a></li> <li><a href="/docs/integrations/finch" class="">Finch</a></li> <li><a href="/docs/integrations/http4s" class="">http4s</a></li></ul></li> <li><a href="/docs/related/" class="">Related Work</a> <ul class="sub_section"> <li><a href="/docs/related/#Bibliography" class="">Bibliography</a></li> <li><a href="/docs/related/#Scala" class="">Scala Libraries</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/47deg/freestyle"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/47deg/freestyle"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Freestyle A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Freestyle A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="47deg" data-github-repo="freestyle"><div class="content-wrapper"><section><h3 id="akka-http">Akka HTTP</h3>

<p><a href="http://doc.akka.io/docs/akka-http/10.0.5/java/http/introduction.html">Akka HTTP</a> (formerly known as <code class="highlighter-rouge">spray</code>) is an Akka-based library for implementing HTTP services.
Akka HTTP is frequently used to write server-side (a.k.a back-end) REST APIs; for instance, we (47 Degrees) have used it to write the back-ends
for the <a href="https://github.com/47deg/nine-cards-backend">9Cards</a> or the <a href="http://scaladays.org/">ScalaDays</a> mobile applications.
Akka HTTP makes it easy to write such APIs, due to its <a href="http://doc.akka.io/docs/akka-http/10.0.5/java/http/introduction.html">routing DSL</a>.
In this DSL, routes are written using directives, that filter incoming requests, and end in a <code class="highlighter-rouge">complete</code> directive.
The <code class="highlighter-rouge">complete</code> directive can take just a message, or just the status code to give back; but more frequently, it takes as an argument
an expression, or program call, whose result is the <em>response body</em> that is given back to the client.</p>

<p>The goal of <code class="highlighter-rouge">freestyle</code> integration with Akka HTTP is to allow programmers to pass into a <code class="highlighter-rouge">complete</code> directive an expression of type <code class="highlighter-rouge">fs : FreeS[F, A]</code>, 
where <code class="highlighter-rouge">F[_]</code> is the type constructor, and  <code class="highlighter-rouge">A</code> is the type of the result. In respect to this goal,
the <a href="http://doc.akka.io/docs/akka-http/10.0.5/java/http/introduction.html#routing-dsl-for-http-servers">Akka HTTP docs</a> say that:</p>

<blockquote>
  <p>Transforming request […] bodies between over-the-wire formats and objects to be used in your application
is done separately from the route declarations, in marshallers, which are pulled in implicitly using the “magnet” pattern.
This means that you can complete a request with any kind of object a as long as there is an implicit marshaller available in scope.</p>
</blockquote>

<p>Thus, the <code class="highlighter-rouge">freestyle</code> integration for Akka HTTP provides an extension of that <em>magnet</em> pattern, which allow us to generate
response <a href="http://doc.akka.io/docs/akka-http/current/scala/http/common/marshalling.html">marshallers</a>.
To be precise, what the integration gives is an <code class="highlighter-rouge">implicit</code> method that may generate an object of type</p>

<pre><code class="language-Scala">marsh: ToEntityMarshaller[  FreeS[ F, A ] ]
</code></pre>
<p>for some types parameters <code class="highlighter-rouge">F[_]</code> , which is the target of the algebra, and for some base result type <code class="highlighter-rouge">A</code>.
Note that the method has to be parametrised both on the <code class="highlighter-rouge">F</code> and on <code class="highlighter-rouge">A</code>, to make it as generic as possible.
This is the method we have:</p>

<pre><code class="language-Scala">  implicit def seqToEntityMarshaller[F[_], G[_], A](
      implicit NT: F ~&gt; G,
      MonG: Monad[G],
      gem: ToEntityMarshaller[G[A]]
  ): ToEntityMarshaller[FreeS[F, A]] =
    gem.compose((fs: FreeS[F, A]) =&gt; fs.exec[G])
</code></pre>

<p>To build such an object <code class="highlighter-rouge">marsh</code>, our method needs to find in scope :</p>

<ul>
  <li>A <em>base</em> entity marshaller, <code class="highlighter-rouge">base: ToEntityMarshaller[ G[A]]</code>, where <code class="highlighter-rouge">G[_]</code> is a constructor type, which may be different for each application; 
and <code class="highlighter-rouge">A</code> refers to the same type of the result in the response.</li>
  <li>A way to interpret an expression of type <code class="highlighter-rouge">FreeS[F, A]</code> into a <code class="highlighter-rouge">G[A]</code>. This is built by the implicit metods in
<code class="highlighter-rouge">freestyle.implicits</code>, from a natural transformation <code class="highlighter-rouge">F ~&gt; G</code> and an instance of <code class="highlighter-rouge">cats.Monad[G]</code>.</li>
</ul>

<p>In essence, the generated marshaller first <em>interprets</em> the value of type <code class="highlighter-rouge">FreeS[F,A]</code> into a <code class="highlighter-rouge">G[A]</code>, and then it passes the generated
value to the base marshaller. To build an Akka HTTP route using a <code class="highlighter-rouge">FreeS</code> program, one only needs to bring this method into the implicit context, which can be done using an
<code class="highlighter-rouge">import freestyle.http.akka._</code> statement.</p>

<h4 id="small-example">Small Example</h4>

<p>As an example, here is a small API program mixing <code class="highlighter-rouge">freestyle</code> and Akka HTTP. The integration is not part of <code class="highlighter-rouge">freestyle</code> main module.
You need to import it separately, by adding the following dependency:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"io.freestyle"</span> <span class="o">%%</span> <span class="s">"freestyle-http-akka"</span> <span class="o">%</span> <span class="s">"0.1.0"</span>
</code></pre>
</div>

<p>First, we (1) define a domain class <code class="highlighter-rouge">User</code>, (2) write
a <code class="highlighter-rouge">@free</code> algebra that returns values of a type <code class="highlighter-rouge">FreeS[F, User]</code>, and then (3) define an interpreter for that algebra to a type for 
which a <code class="highlighter-rouge">Marshaller</code> <em>magnet</em> exists. To keep things simple, we just interpret to <code class="highlighter-rouge">Id</code>.</p>

<pre><code class="language-Scala">import freestyle._
import freestyle.implicits._

case class User(name: String)

@free
trait UserApp[F[_]] {
  def get(id: Int): FreeS[F, User]
}

val app = UserApp.to[UserApp.Op]
</code></pre>

<p>To use this <code class="highlighter-rouge">@free</code> algebra in a route, we need (1) an <code class="highlighter-rouge">EntityMarshaller</code> for our domain object,
and (2) an interpreter of the algebra to a suitable domain, which for this example will be <code class="highlighter-rouge">Id</code>.</p>

<pre><code class="language-Scala">import _root_.akka.http.scaladsl.marshalling.ToEntityMarshaller

implicit val userMarshaller: ToEntityMarshaller[User] =
  Marshaller.StringMarshaller.compose((user: User) =&gt; s"User(${user.name})")

implicit val handler: UserApp.Handler[Id] = new UserApp.Handler[Id] {
  private[this] val users: Map[Int, User] = Map( 1 -&gt; User("foo") )
    override def get(id: Int): User = users.get(id).getOrElse(User("default"))
}
</code></pre>

<p>With these in scope, one can now write the route by using the marshaller generators from Akka HTTP.</p>

<pre><code class="language-Scala">import _root_.akka.http.scaladsl.server.Directives._
import _root_.akka.http.scaladsl.server.Route
import _root_.akka.http.scaladsl.marshalling.{Marshaller, ToEntityMarshaller}
import _root_.akka.http.scaladsl.server.PathMatchers.IntNumber

val route: Route =  (get &amp; path("user" / IntNumber)) { id =&gt;
  complete(app.get(id))
}
</code></pre>

<p>More complex routes can be created as usual by chaining and grouping simple routes.
Each route can use a different algebra, or can be interpreted to a different target type <code class="highlighter-rouge">G[_]</code>.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/js/main.js"></script><script src="/js/kazari.js"></script><script>
$(document).ready(function() {
	kazari.KazariPlugin().decorateCode('https://scala-evaluator-212.herokuapp.com/eval', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.S2F6YXJp.Jl2eqMfw8IakJF93PjxTbrf-8YUJgX5OoOfy5JHE8Yw', '', 'dracula')
})
    </script></body></html>