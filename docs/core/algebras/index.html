<html><head><title>Freestyle: Algebras</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="47 Degrees" /><meta name="description" content="A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries" /><meta name="og:image" content="/img/poster.png" /><meta name="og:title" content="Freestyle: Algebras" /><meta name="og:site_name" content="Freestyle" /><meta name="og:url" content="https://frees-io.github.io/freestyle/" /><meta name="og:type" content="website" /><meta name="og:description" content="A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Freestyle: Algebras" /><meta name="twitter:image" content="https://frees-io.github.io/freestyle/img/poster.png" /><meta name="twitter:description" content="A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/dracula.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><link rel="stylesheet" href="/css/theme-code.css" /><link rel="stylesheet" href="/css/custom.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-18433785-14' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Freestyle</span></div></a></li> <li><a href="/docs/" class="">Quick Start</a></li> <li><a href="/docs/core/" class="">Core Concepts</a> <ul class="sub_section"> <li><a href="/docs/core/algebras/" class=" active ">Algebras</a></li> <li><a href="/docs/core/modules/" class="">Modules</a></li> <li><a href="/docs/core/handlers/" class="">Handlers</a></li> <li><a href="/docs/core/parallelism/" class="">Parallelism</a></li></ul></li> <li><a href="/docs/effects/" class="">Effects</a> <ul class="sub_section"> <li><a href="/docs/effects/error" class="">Error</a></li> <li><a href="/docs/effects/either" class="">Either</a></li> <li><a href="/docs/effects/option" class="">Option</a></li> <li><a href="/docs/effects/reader" class="">Reader</a></li> <li><a href="/docs/effects/writer" class="">Writer</a></li> <li><a href="/docs/effects/state" class="">State</a></li> <li><a href="/docs/effects/traverse" class="">Traverse</a></li> <li><a href="/docs/effects/validation" class="">Validation</a></li> <li><a href="/docs/effects/async" class="">Async Callbacks</a></li></ul></li> <li><a href="/docs/optimizations/" class="">Optimizations</a></li> <li><a href="/docs/stack/" class="">Example Target Stack</a></li> <li><a href="/TODO.html" class="">Patterns</a> <ul class="sub_section"> <li><a href="/docs/effects/Cache/" class="">Cache</a></li> <li><a href="/TODO.html" class="">Dependency Injection</a></li> <li><a href="/docs/patterns/config" class="">Configuration</a></li> <li><a href="/docs/patterns/logging" class="">Logging</a></li></ul></li> <li><a href="/docs/integrations" class="">Integrations</a> <ul class="sub_section"> <li><a href="/docs/integrations/cats" class="">Cats</a></li> <li><a href="/docs/integrations/play" class="">Play Framework</a></li> <li><a href="/docs/integrations/monix" class="">Monix</a></li> <li><a href="/docs/integrations/fetch" class="">Fetch</a></li> <li><a href="/docs/integrations/doobie" class="">Doobie</a></li> <li><a href="/docs/integrations/slick" class="">Slick</a></li> <li><a href="/docs/integrations/akkahttp" class="">Akka HTTP</a></li> <li><a href="/docs/integrations/finch" class="">Finch</a></li> <li><a href="/docs/integrations/http4s" class="">http4s</a></li> <li><a href="/docs/integrations/hammock" class="">Hammock</a></li></ul></li> <li><a href="/docs/rpc" class="">Microservices</a> <ul class="sub_section"> <li><a href="/docs/rpc/quickstart" class="">Quickstart</a></li> <li><a href="/docs/rpc/core-concepts" class="">Core concepts</a></li> <li><a href="/docs/rpc/streaming" class="">Streaming</a></li> <li><a href="/docs/rpc/annotations" class="">Annotations</a></li> <li><a href="/docs/rpc/idl-generation" class="">IDL Generation</a></li> <li><a href="/docs/rpc/patterns" class="">Patterns</a></li> <li><a href="/docs/rpc/ssl-tls" class="">SSL/TLS</a></li> <li><a href="/docs/rpc/metrics-reporting" class="">Metrics Reporting</a></li> <li><a href="/docs/rpc/references" class="">References</a></li></ul></li> <li><a href="/docs/libraries" class="">Libraries</a> <ul class="sub_section"> <li><a href="/docs/effects" class="">Effects</a></li> <li><a href="/docs/cassandra" class="">Cassandra</a></li> <li><a href="/docs/kafka" class="">Kafka</a></li></ul></li> <li><a href="/docs/related/" class="">Related Work</a> <ul class="sub_section"> <li><a href="/docs/related/#bibliography" class="">Bibliography</a></li> <li><a href="/docs/related/#Scala" class="">Scala Libraries</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/frees-io/freestyle"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/frees-io/freestyle"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Freestyle A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Freestyle A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="frees-io" data-github-repo="freestyle"><div class="content-wrapper"><section><h1 id="algebras">Algebras</h1>

<p>Algebraic Data Types are the foundation used to define <code class="highlighter-rouge">Free</code> based applications and libraries that express their operations as algebras. At the core of Freestyle algebras is the <code class="highlighter-rouge">@free</code> macro annotation. <code class="highlighter-rouge">@free</code> expands abstract traits and classes automatically deriving Algebraic Data types and all the machinery needed to compose them from abstract method definitions.</p>

<p>When you build an algebra with Freestyle, you only need to concentrate on the API that you want to be exposed as abstract smart constructors, without worrying how they will be implemented.</p>

<p>In Freestyle, an <strong>algebra</strong> is a trait or abstract class annotated with <code class="highlighter-rouge">@free</code> or <code class="highlighter-rouge">@tagless</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">freestyle.free._</span>
<span class="c1">// import freestyle.free._
</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="c1">// defined class User
</span>
<span class="nd">@free</span> <span class="k">trait</span> <span class="nc">Users</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">save</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">User</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">list</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">User</span><span class="o">]]</span>
<span class="o">}</span>
<span class="c1">// defined trait Users
// defined object Users
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">Users</code> trait declares three smart constructors, named <code class="highlighter-rouge">get</code>, <code class="highlighter-rouge">save</code>, and <code class="highlighter-rouge">list</code>, which generate the basic operations in the algebra. A <strong>smart constructor</strong> is an abstract method declaration with a return type of the form <code class="highlighter-rouge">FS[Ret]</code>, where <code class="highlighter-rouge">Ret</code> is the type of the data computed by the operation, and <code class="highlighter-rouge">FS[_]</code>  marks the method as an operation of the algebra. Intuitively, <code class="highlighter-rouge">FS</code> means that the method gives a computation within some (generic) context or effect <code class="highlighter-rouge">FS</code>. 
For example, the <code class="highlighter-rouge">save</code> smart constructor has a return type <code class="highlighter-rouge">FS[User]</code>. Intuitively, this declares <code class="highlighter-rouge">save</code> as a computation in a context (or effect) <code class="highlighter-rouge">FS</code>, whose result will be a <code class="highlighter-rouge">User</code> object.</p>

<p>The <code class="highlighter-rouge">@free</code> is a Scala <a href="https://www.scala-lang.org/blog/2017/10/09/scalamacros.html">macro annotation</a>, that replaces the annotated trait <code class="highlighter-rouge">Users</code> by a modified trait, and generates a companion object, as in the code below:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">freestyle.free.FreeS</span>
<span class="k">import</span> <span class="nn">freestyle.free.internal.EffectLike</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">trait</span> <span class="nc">Users</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="nc">extends</span> <span class="nc">EffectLike</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">save</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">User</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">getAll</span><span class="o">(</span><span class="n">filter</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">User</span><span class="o">]]</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Users</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">_root_.cats.arrow.FunctionK</span>
  <span class="k">import</span> <span class="nn">_root_.freestyle.free.InjK</span>
  <span class="k">import</span> <span class="nn">_root_.freestyle.free.FreeS</span>

  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Op</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="nc">extends</span> <span class="nc">Product</span> <span class="k">with</span> <span class="nc">Serializable</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">GetOp</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Op</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SaveOp</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">User</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Op</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">GetAllOp</span><span class="o">(</span><span class="n">filter</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Op</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">User</span><span class="o">]]</span>

  <span class="k">class</span> <span class="nc">To</span><span class="o">[</span><span class="kt">L</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">ii</span><span class="k">:</span> <span class="kt">InjK</span><span class="o">[</span><span class="kt">Op</span>, <span class="kt">L</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Users</span><span class="o">[</span><span class="kt">L</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">val</span> <span class="n">inj</span> <span class="k">=</span> <span class="nc">FreeS</span><span class="o">.</span><span class="n">inject</span><span class="o">[</span><span class="kt">Op</span>, <span class="kt">L</span><span class="o">](</span><span class="n">ii</span><span class="o">)</span>

    <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="k">=</span> <span class="n">inj</span><span class="o">(</span> <span class="nc">GetOp</span><span class="o">(</span><span class="n">id</span><span class="o">)</span> <span class="o">)</span>
    <span class="k">def</span> <span class="n">save</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">User</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span> <span class="k">=</span> <span class="n">inj</span><span class="o">(</span> <span class="nc">SaveOp</span><span class="o">(</span><span class="n">user</span><span class="o">)</span> <span class="o">)</span>
    <span class="k">def</span> <span class="n">getAll</span><span class="o">(</span><span class="n">filter</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">User</span><span class="o">]]</span> <span class="k">=</span> <span class="n">inj</span><span class="o">(</span> <span class="nc">GetAllOp</span><span class="o">(</span><span class="n">filter</span><span class="o">)</span> <span class="o">)</span>
  <span class="o">}</span>

  <span class="k">implicit</span> <span class="k">def</span> <span class="n">to</span><span class="o">[</span><span class="kt">L</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">InjK</span><span class="o">[</span><span class="kt">Op</span>, <span class="kt">L</span><span class="o">])</span><span class="k">:</span> <span class="kt">Users</span><span class="o">[</span><span class="kt">L</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">To</span><span class="o">[</span><span class="kt">L</span><span class="o">]</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">L</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">c</span><span class="k">:</span> <span class="kt">Users</span><span class="o">[</span><span class="kt">L</span><span class="o">])</span><span class="k">:</span> <span class="kt">Users</span><span class="o">[</span><span class="kt">L</span><span class="o">]</span> <span class="k">=</span> <span class="n">c</span>

  <span class="k">trait</span> <span class="nc">Handler</span><span class="o">[</span><span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="nc">extends</span> <span class="nc">FSHandler</span><span class="o">[</span><span class="kt">Op</span>, <span class="kt">M</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">protected</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
    <span class="k">protected</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">def</span> <span class="n">save</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">User</span><span class="o">)</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
    <span class="k">protected</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">def</span> <span class="n">getAll</span><span class="o">(</span><span class="n">filter</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">User</span><span class="o">]]</span>

    <span class="k">override</span> <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">Op</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">fa</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">l</span> <span class="k">@</span> <span class="nc">GetOp</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">get</span><span class="o">(</span><span class="n">l</span><span class="o">.</span><span class="n">id</span><span class="o">)</span>
      <span class="k">case</span> <span class="n">l</span> <span class="k">@</span> <span class="nc">SaveOp</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">save</span><span class="o">(</span><span class="n">l</span><span class="o">.</span><span class="n">user</span><span class="o">)</span>
      <span class="k">case</span> <span class="n">l</span> <span class="k">@</span> <span class="nc">GetAllOp</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">getAll</span><span class="o">(</span><span class="n">l</span><span class="o">.</span><span class="n">filter</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Let us examine how the <code class="highlighter-rouge">@free</code>-annotated trait relates to the code generated from it.</p>

<h3 id="generalise-trait">Generalise Trait</h3>

<p>The <code class="highlighter-rouge">@free</code> macro makes two changes to the trait <code class="highlighter-rouge">Users</code>.</p>

<ol>
  <li>
    <p>It adds a type parameter <code class="highlighter-rouge">F[_]</code>, of kind <code class="highlighter-rouge">* -&gt; *</code>, which is a general type in which operations are constructed. This makes <code class="highlighter-rouge">Users[F[_]]</code> resemble a <a href="https://pchiusano.github.io/2014-05-20/scala-gadts.html"><em>Generalised Abstract Data Type (GADT)</em></a>, an interface to construct the algebra’s operations into a type <code class="highlighter-rouge">F[_]</code>.</p>
  </li>
  <li>
    <p>It makes <code class="highlighter-rouge">Users</code> to extend <code class="highlighter-rouge">EffectLike[F[_]]</code>. This trait defines the type <code class="highlighter-rouge">FS[_]</code>, used in the smart constructors, as <code class="highlighter-rouge">FS[_] = FreeS.Par[F]</code>, which in turn is an alias for <code class="highlighter-rouge">Free[FreeApplicative[F, ?], ?]</code>.</p>
  </li>
</ol>

<p>The <code class="highlighter-rouge">@free</code> annotation works as a syntactic sugar for writing a GADT in Scala. Without the <code class="highlighter-rouge">EffectLike</code> trait, the algebra GADT would be written as follows:</p>
<pre><code class="language-Scala">trait Users[F[_]] {
  def get(id: Long): FreeS.Par[F, User]
  def save(user: User): FreeS.Par[F, User]
  def getAll(filter: String): FreeS.Par[F, List[User]]
}
</code></pre>

<h3 id="algebraic-data-type">Algebraic Data Type</h3>

<p>From the abstract smart constructors, <code class="highlighter-rouge">@free</code> generates an algebraic data type (ADT) of operations inside the companion object.
This Algebraic data type contains the shape needed to implement the abstract methods.</p>

<pre><code class="language-Scala">  sealed trait Op[A] extends Product with Serializable

  final case class GetOp(id: Long) extends Op[User]
  final case class SaveOp(user: User) extends Op[User]
  final case class GetAllOp(filter: String) extends Op[List[User]]
</code></pre>
<p>Some important features of this ADT are the following ones:</p>
<ul>
  <li>The root of the ADT is a sealed trait <code class="highlighter-rouge">Op[A]</code>. Note that this name <code class="highlighter-rouge">Op</code> is the same in <em>every</em> <code class="highlighter-rouge">@free</code>-generated algebra.</li>
  <li>For each smart constructor <code class="highlighter-rouge">def foo(x: X, y: Y, ...): FS[Z]</code>, the <code class="highlighter-rouge">@free</code> generates a case class <code class="highlighter-rouge">Foo</code>, whose fields are the parameters of the constructor. For those with a background in object-oriented design, this is similar to the <a href="http://wiki.c2.com/?CommandPattern">Command Pattern</a>.</li>
  <li>The parameter <code class="highlighter-rouge">A</code> in the root trait <code class="highlighter-rouge">Op[A]</code> describes the type of the expected result of that operation.</li>
</ul>

<h3 id="injection">Injection</h3>

<p>If the modified trait <code class="highlighter-rouge">Users[F[_]]</code> declares an interface for the algebra, the companion object <code class="highlighter-rouge">Users</code> provides an implementation for that interface.</p>

<p>The <code class="highlighter-rouge">@free</code> annotation adds into the companion object a class <code class="highlighter-rouge">To[L[_]]</code>, which implements the <code class="highlighter-rouge">Users</code> GADT for the target type <code class="highlighter-rouge">L[_]</code> by using an <code class="highlighter-rouge">InjK[Op, L]</code> object. An <code class="highlighter-rouge">InjK[F[_], G[_]]</code> is a special type of tranformation, much like the <code class="highlighter-rouge">FunctionK</code> in <code class="highlighter-rouge">cats</code>, that allows to transform a <code class="highlighter-rouge">F[A]</code> into a <code class="highlighter-rouge">G[A]</code>. In the case of the <code class="highlighter-rouge">To</code> class, we need an <code class="highlighter-rouge">InjK[Op, L]</code>, that allows transforming an object <code class="highlighter-rouge">Req[A]</code> in the <code class="highlighter-rouge">Op</code> ADT above, to a value <code class="highlighter-rouge">L[A]</code> in the target type <code class="highlighter-rouge">L</code>. The class <code class="highlighter-rouge">To[L[_]]</code> implements each operation of the algebra by just applying that <code class="highlighter-rouge">InjK</code> object to the instance of the <code class="highlighter-rouge">Op</code> ADT.</p>

<p>The <code class="highlighter-rouge">InjK</code> is based the <code class="highlighter-rouge">Inject</code> strategy from the <a href="http://www.cs.ru.nl/~W.Swierstra/Publications/DataTypesALaCarte.pdf">Data types à-la-Carte</a> article, which describes how to compose unrelated ADTs using the Coproduct (or <code class="highlighter-rouge">EitherK</code> in <code class="highlighter-rouge">cats</code>).</p>

<h3 id="dependency-injection">Dependency Injection</h3>

<p>As you may have noticed when defining algebras with <code class="highlighter-rouge">@free</code>, there is no need to provide implicit evidence for the necessary <code class="highlighter-rouge">Inject</code> typeclasses that otherwise need to be manually provided to further evaluate your free monads when they are interleaved with other <code class="highlighter-rouge">Free</code> programs.</p>

<p>Beside providing the appropriate <code class="highlighter-rouge">Inject</code> evidences,  Freestyle creates an implicit method that will enable implicit summoning of the smart constructors class implementation and an <code class="highlighter-rouge">apply</code> method that allows summoning instances of your smart constructors where needed.
This effectively enables implicits based Dependency Injection where you may choose to override implementations using the implicits scoping rules to place different implementations where appropriate.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">users</span> <span class="k">=</span> <span class="nc">Users</span><span class="o">[</span><span class="kt">Users.Op</span><span class="o">]</span>
<span class="c1">// users: Users[Users.Op] = Users$To@29354395
</span>
<span class="k">def</span> <span class="n">myService</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">users</span><span class="k">:</span> <span class="kt">Users</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span> <span class="k">=</span> <span class="o">???</span>
<span class="c1">// myService: [F[_]](implicit users: Users[F])Nothing
</span>
<span class="k">def</span> <span class="n">myService2</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Users</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
<span class="c1">// myService2: [F[_]](implicit evidence$1: Users[F])Nothing
</span></code></pre></div></div>

<h3 id="composed-operations">Composed Operations</h3>

<p>The trait <code class="highlighter-rouge">EffectLike[F[_]]</code> mentioned above, apart from the type alias <code class="highlighter-rouge">FS[_]</code>, also defines two type aliases <code class="highlighter-rouge">FS.Seq[_]</code> and <code class="highlighter-rouge">FS.Par[]</code>.</p>

<pre><code class="language-Scala">trait EffectLike[F[_]] {
  final type FS[A] = FreeS.Par[F, A]
  final object FS {
    final type Seq[A] = FreeS[F, A]
    final type Par[A] = FreeS.Par[F, A]
  }
}
</code></pre>

<p>These type aliases can be used to define some <code class="highlighter-rouge">FS</code> operations that are derived from other operations. , by combining other operations:</p>

<ul>
  <li><code class="highlighter-rouge">FS.Par[A]</code> is an alias for <code class="highlighter-rouge">FreeApplicative[F, A]</code>. You can declare a derived operation of type <code class="highlighter-rouge">FS.Par</code> by applying the methods of the <code class="highlighter-rouge">Functor</code> and <code class="highlighter-rouge">Applicative</code> type classes.</li>
  <li><code class="highlighter-rouge">FS.Seq[A]</code> is an alias for <code class="highlighter-rouge">Free[FreeApplicative[F, ?], A]</code>, that can be combined using the methods of the <code class="highlighter-rouge">Monad</code> type class.</li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.syntax.apply._</span>
<span class="c1">// import cats.syntax.apply._
</span>
<span class="k">import</span> <span class="nn">cats.syntax.monad._</span>
<span class="c1">// import cats.syntax.monad._
</span>
<span class="nd">@free</span> <span class="k">trait</span> <span class="nc">X</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">a</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">b</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS.Par</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">a</span><span class="o">.</span><span class="n">map</span><span class="o">(</span> <span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">i</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">c</span><span class="k">:</span> <span class="kt">FS.Par</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">(</span><span class="mi">42</span><span class="o">)).</span><span class="n">mapN</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">d</span><span class="k">:</span> <span class="kt">FS.Seq</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">c</span><span class="o">.</span><span class="n">freeS</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">b</span><span class="o">(</span><span class="n">x</span><span class="o">).</span><span class="n">freeS</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// defined trait X
// defined object X
</span></code></pre></div></div>

<p>We use the type aliae <code class="highlighter-rouge">FS.Seq</code> and <code class="highlighter-rouge">FS.Par</code> to indicate complex operations, which combine the algebra’s basic requests with the operations from the <code class="highlighter-rouge">Monad</code> (or <code class="highlighter-rouge">Applicative</code>) type class. The names follow the intuition that <code class="highlighter-rouge">Applicative</code> operations combine data-independent computations that can be run in parallel, and <code class="highlighter-rouge">Monad</code> operations combine data-dependent computations that need to be run in sequence.</p>

<p>Note that, although  <code class="highlighter-rouge">FS[_]</code> and <code class="highlighter-rouge">FS.Par[_]</code> are equivalent, <code class="highlighter-rouge">@free</code> only allows using the former for abstract methods.</p>

<h2 id="convenient-type-aliases">Convenient type aliases</h2>

<p>As described above, <code class="highlighter-rouge">@free</code> always uses the name <code class="highlighter-rouge">Op</code> for the sealed trait at the root of the requests ADT. This allows you to access it uniformly, for instance to build a <code class="highlighter-rouge">Coproduct</code> type that helps you to parametrize you application code. Here is an example for this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.data.EitherK</span>
<span class="c1">// import cats.data.EitherK
</span>
<span class="nd">@free</span> <span class="k">trait</span> <span class="nc">Service1</span><span class="o">{</span>
  <span class="k">def</span> <span class="n">x</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
<span class="o">}</span>
<span class="c1">// defined trait Service1
// defined object Service1
</span>
<span class="nd">@free</span> <span class="k">trait</span> <span class="nc">Service2</span><span class="o">{</span>
  <span class="k">def</span> <span class="n">y</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
<span class="o">}</span>
<span class="c1">// defined trait Service2
// defined object Service2
</span>
<span class="nd">@free</span> <span class="k">trait</span> <span class="nc">Service3</span><span class="o">{</span>
  <span class="k">def</span> <span class="n">z</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
<span class="o">}</span>
<span class="c1">// defined trait Service3
// defined object Service3
</span>
<span class="k">type</span> <span class="kt">C1</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">EitherK</span><span class="o">[</span><span class="kt">Service1.Op</span>, <span class="kt">Service2.Op</span>, <span class="kt">A</span><span class="o">]</span>
<span class="c1">// defined type alias C1
</span>
<span class="k">type</span> <span class="kt">Module</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">EitherK</span><span class="o">[</span><span class="kt">Service3.Op</span>, <span class="kt">C1</span>, <span class="kt">A</span><span class="o">]</span>
<span class="c1">// defined type alias Module
</span></code></pre></div></div>

<p>This is obviously far from ideal, as building <code class="highlighter-rouge">EitherK</code> types by hand often results in bizarre compile errors when the types don’t align properly from being placed in the wrong order.</p>

<h3 id="combining-tagless-and-free-algebras">Combining <code class="highlighter-rouge">@tagless</code> and <code class="highlighter-rouge">@free</code> algebras</h3>

<p>Freestyle allows us to compose <code class="highlighter-rouge">@free</code> and <code class="highlighter-rouge">@tagless</code> algebras. Let us consider the following <code class="highlighter-rouge">@tagless</code> algebras:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">freestyle.tagless._</span>
<span class="c1">// import freestyle.tagless._
</span>
<span class="nd">@tagless</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="k">trait</span> <span class="nc">Validation</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">minSize</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">hasNumber</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>
<span class="o">}</span>
<span class="c1">// defined trait Validation
// defined object Validation
</span>
<span class="nd">@tagless</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="k">trait</span> <span class="nc">Interaction</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">tell</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">ask</span><span class="o">(</span><span class="n">prompt</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
<span class="o">}</span>
<span class="c1">// defined trait Interaction
// defined object Interaction
</span></code></pre></div></div>

<p>For every <code class="highlighter-rouge">@tagless</code> algebra, there is also a free-based representation that is stack-safe by nature, and that can be used
to lift <code class="highlighter-rouge">@tagless</code> algebras to a context mixing <code class="highlighter-rouge">@free</code> and <code class="highlighter-rouge">@tagless</code> algebras.</p>

<p>Let’s redefine <code class="highlighter-rouge">program</code> to support <code class="highlighter-rouge">LoggingM</code> which is a <code class="highlighter-rouge">@free</code> defined algebra of logging operations:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">freestyle.free._</span>
<span class="k">import</span> <span class="nn">freestyle.free.implicits._</span>

<span class="k">import</span> <span class="nn">freestyle.free.logging._</span>
<span class="k">import</span> <span class="nn">freestyle.free.loggingJVM.implicits._</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">program</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span>
   <span class="o">(</span><span class="k">implicit</span> <span class="n">log</span><span class="k">:</span> <span class="kt">LoggingM</span><span class="o">[</span><span class="kt">F</span><span class="o">],</span> 
             <span class="n">validation</span> <span class="k">:</span> <span class="kt">Validation.StackSafe</span><span class="o">[</span><span class="kt">F</span><span class="o">],</span> 
             <span class="n">interaction</span><span class="k">:</span> <span class="kt">Interaction.StackSafe</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>

  <span class="k">import</span> <span class="nn">cats.implicits._</span>

  <span class="k">for</span> <span class="o">{</span>
    <span class="n">userInput</span> <span class="k">&lt;-</span> <span class="n">interaction</span><span class="o">.</span><span class="n">ask</span><span class="o">(</span><span class="s">"Give me something with at least 3 chars and a number on it"</span><span class="o">)</span>
    <span class="n">valid</span> <span class="k">&lt;-</span> <span class="o">(</span><span class="n">validation</span><span class="o">.</span><span class="n">minSize</span><span class="o">(</span><span class="n">userInput</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="n">validation</span><span class="o">.</span><span class="n">hasNumber</span><span class="o">(</span><span class="n">userInput</span><span class="o">)).</span><span class="n">mapN</span><span class="o">(</span><span class="k">_</span> <span class="o">&amp;&amp;</span> <span class="k">_</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span>
            <span class="n">interaction</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="s">"awesomesauce!"</span><span class="o">)</span> 
         <span class="k">else</span>
            <span class="n">interaction</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="n">s</span><span class="s">"$userInput is not valid"</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">"Program finished"</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="o">()</span>
<span class="o">}</span>
<span class="c1">// program: [F[_]](implicit log: freestyle.free.logging.LoggingM[F], implicit validation: Validation.StackSafe[F], implicit interaction: Interaction.StackSafe[F])cats.free.Free[[β$0$]cats.free.FreeApplicative[F,β$0$],Unit]
</span></code></pre></div></div>

<p>Since <code class="highlighter-rouge">Validation</code> and <code class="highlighter-rouge">Interaction</code> were <code class="highlighter-rouge">@tagless</code> algebras, we need their <code class="highlighter-rouge">StackSafe</code> representation in order to combine
them with <code class="highlighter-rouge">@free</code> algebras.</p>

<p>Fear not. Freestyle provides a <a href="../modules/">modular system</a> to achieve Onion-style architectures
and removes all the complexity from building <code class="highlighter-rouge">EitherK</code> types by hand and compose arbitrarily nested Modules containing Algebras.</p>

<p><a href="../modules/">Continue to Modules</a>.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: '47deg/freestyle'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>