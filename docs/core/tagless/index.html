<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Freestyle</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries" /><meta name="author" content="47 Degrees" /><meta name="og:image" content="/img/poster.png" /><meta name="og:title" content="Freestyle" /><meta name="og:site_name" content="Freestyle" /><meta name="og:url" content="https://47deg.github.io/freestyle/" /><meta name="og:type" content="website" /><meta name="og:description" content="A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><meta name="kazari-dependencies" content="" /><meta name="kazari-resolvers" content="" /><link rel="icon" type="image/png" href="/img/favicon.png" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/dracula.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><link rel="stylesheet" href="/css/kazari-style.css" /><link rel="stylesheet" href="/css/solarized-dark.css" /><link rel="stylesheet" href="/css/custom.css" /><link rel="stylesheet" href="/css/dracula.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Freestyle</span></div></a></li> <li><a href="/docs/" class="">Quick Start</a></li> <li><a href="/" class="">Core Concepts</a> <ul class="sub_section"> <li><a href="/docs/core/algebras/" class="">Algebras</a></li> <li><a href="/docs/core/interpreters/" class="">Handlers</a></li> <li><a href="/docs/core/parallelism/" class="">Parallelism</a></li> <li><a href="/docs/core/modules/" class="">Modules</a></li> <li><a href="/docs/core/tagless/" class=" active ">Tagless Final</a></li></ul></li> <li><a href="/docs/effects/" class="">Effects</a> <ul class="sub_section"> <li><a href="/docs/effects/error" class="">Error</a></li> <li><a href="/docs/effects/either" class="">Either</a></li> <li><a href="/docs/effects/option" class="">Option</a></li> <li><a href="/docs/effects/reader" class="">Reader</a></li> <li><a href="/docs/effects/writer" class="">Writer</a></li> <li><a href="/docs/effects/state" class="">State</a></li> <li><a href="/docs/effects/traverse" class="">Traverse</a></li> <li><a href="/docs/effects/validation" class="">Validation</a></li> <li><a href="/docs/effects/async" class="">Async Callbacks</a></li></ul></li> <li><a href="/docs/stack/" class="">Example Target Stack</a></li> <li><a href="/TODO.html" class="">Patterns</a> <ul class="sub_section"> <li><a href="/docs/effects/Cache/" class="">Cache</a></li> <li><a href="/TODO.html" class="">Dependency Injection</a></li> <li><a href="/docs/patterns/config" class="">Configuration</a></li> <li><a href="/docs/patterns/logging" class="">Logging</a></li></ul></li> <li><a href="/docs/integrations" class="">Integrations</a> <ul class="sub_section"> <li><a href="/docs/integrations/cats" class="">Cats</a></li> <li><a href="/docs/integrations/play" class="">Play Framework</a></li> <li><a href="/docs/integrations/monix" class="">Monix</a></li> <li><a href="/docs/integrations/fetch" class="">Fetch</a></li> <li><a href="/docs/integrations/fs2" class="">FS2</a></li> <li><a href="/docs/integrations/doobie" class="">Doobie</a></li> <li><a href="/docs/integrations/slick" class="">Slick</a></li> <li><a href="/docs/integrations/akkahttp" class="">Akka HTTP</a></li> <li><a href="/docs/integrations/finch" class="">Finch</a></li> <li><a href="/docs/integrations/http4s" class="">http4s</a></li></ul></li> <li><a href="/docs/related/" class="">Related Work</a> <ul class="sub_section"> <li><a href="/docs/related/#bibliography" class="">Bibliography</a></li> <li><a href="/docs/related/#Scala" class="">Scala Libraries</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/47deg/freestyle"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/47deg/freestyle"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Freestyle A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Freestyle A Cohesive &amp; Pragmatic Framework of FP centric Scala libraries');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="47deg" data-github-repo="freestyle"><div class="content-wrapper"><section><h1 id="tagless-final">Tagless Final</h1>

<p>Freestyle supports additional encodings besides Free monads to achieve pure functional applications and libraries.</p>

<p>Tagless Final is among these and remains syntactically similar to <code class="highlighter-rouge">@free</code>.</p>

<p>To declare an algebra in the Tagless final encoding, you need to depend on <code class="highlighter-rouge">freestyle-tagless</code>.</p>

<h2 id="dependencies">Dependencies</h2>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">addCompilerPlugin</span><span class="o">(</span><span class="s">"org.scalamacros"</span> <span class="o">%</span> <span class="s">"paradise"</span> <span class="o">%</span> <span class="s">"2.1.0"</span> <span class="n">cross</span> <span class="nc">CrossVersion</span><span class="o">.</span><span class="n">full</span><span class="o">)</span>
</code></pre>
</div>

<p>For Scala.jvm:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"com.47deg"</span> <span class="o">%%</span> <span class="s">"freestyle-tagless"</span> <span class="o">%</span> <span class="s">"0.1.0"</span>
</code></pre>
</div>

<p>For Scala.js:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"com.47deg"</span> <span class="o">%%%</span> <span class="s">"freestyle-tagless"</span> <span class="o">%</span> <span class="s">"0.1.0"</span>
</code></pre>
</div>

<h2 id="declaration">Declaration</h2>

<p>Tagless final algebras are declared using the <code class="highlighter-rouge">@tagless</code> macro annotation.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">freestyle._</span>
<span class="c1">// import freestyle._
</span>
<span class="k">import</span> <span class="nn">freestyle.implicits._</span>
<span class="c1">// import freestyle.implicits._
</span>
<span class="k">import</span> <span class="nn">cats._</span>
<span class="c1">// import cats._
</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="c1">// import cats.implicits._
</span>
<span class="nd">@tagless</span> <span class="k">trait</span> <span class="nc">Validation</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">minSize</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">hasNumber</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>
<span class="o">}</span>
<span class="c1">// defined trait Validation
// defined object Validation
</span>
<span class="nd">@tagless</span> <span class="k">trait</span> <span class="nc">Interaction</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">tell</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">ask</span><span class="o">(</span><span class="n">prompt</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FS</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
<span class="o">}</span>
<span class="c1">// defined trait Interaction
// defined object Interaction
</span></code></pre>
</div>

<p>Once your <code class="highlighter-rouge">@tagless</code> algebras are defined, you can start building programs that rely upon implicit evidence of those algebras
being present, for the target runtime monad you are planning to interpret to.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">program</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Monad</span><span class="o">](</span><span class="k">implicit</span> <span class="n">validation</span> <span class="k">:</span> <span class="kt">Validation</span><span class="o">[</span><span class="kt">F</span><span class="o">],</span> <span class="n">interaction</span><span class="k">:</span> <span class="kt">Interaction</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">cats.implicits._</span>

  <span class="k">for</span> <span class="o">{</span>
    <span class="n">userInput</span> <span class="k">&lt;-</span> <span class="n">interaction</span><span class="o">.</span><span class="n">ask</span><span class="o">(</span><span class="s">"Give me something with at least 3 chars and a number on it"</span><span class="o">)</span>
    <span class="n">valid</span> <span class="k">&lt;-</span> <span class="o">(</span><span class="n">validation</span><span class="o">.</span><span class="n">minSize</span><span class="o">(</span><span class="n">userInput</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span> <span class="o">|@|</span> <span class="n">validation</span><span class="o">.</span><span class="n">hasNumber</span><span class="o">(</span><span class="n">userInput</span><span class="o">)).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span> <span class="o">&amp;&amp;</span> <span class="k">_</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span>
            <span class="n">interaction</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="s">"awesomesauce!"</span><span class="o">)</span> 
         <span class="k">else</span>
            <span class="n">interaction</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="n">s</span><span class="s">"$userInput is not valid"</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="o">()</span>
<span class="o">}</span>
<span class="c1">// program: [F[_]](implicit evidence$1: cats.Monad[F], implicit validation: Validation[F], implicit interaction: Interaction[F])F[Unit]
</span></code></pre>
</div>

<p>Note that unlike in <code class="highlighter-rouge">@free</code> <code class="highlighter-rouge">F[_]</code>, here it refers to the target runtime monad. This is to provide an allocation free model where your
ops are not being reified and then interpreted. This allocation step in Free monads is what allows them to be stack-safe.
The tagless final encoding with direct style syntax is as stack-safe as the target <code class="highlighter-rouge">F[_]</code> you are interpreting to.</p>

<h2 id="interpretation">Interpretation</h2>

<p>Once our <code class="highlighter-rouge">@tagless</code> algebras are defined, we can provide <code class="highlighter-rouge">Handler</code> instances in the same way we do with <code class="highlighter-rouge">@free</code>.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.util.Try</span>
<span class="c1">// import scala.util.Try
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">validationHandler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Validation</span><span class="o">.</span><span class="nc">Handler</span><span class="o">[</span><span class="kt">Try</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">minSize</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Try</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">hasNumber</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Try</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">exists</span><span class="o">(</span><span class="n">c</span> <span class="k">=&gt;</span> <span class="s">"0123456789"</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="n">c</span><span class="o">)))</span>
<span class="o">}</span>
<span class="c1">// validationHandler: Validation.Handler[scala.util.Try] = $anon$1@32639176
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">interactionHandler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Interaction</span><span class="o">.</span><span class="nc">Handler</span><span class="o">[</span><span class="kt">Try</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">tell</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Try</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="o">))</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">ask</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Try</span><span class="o">(</span><span class="s">"This could have been user input 1"</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// interactionHandler: Interaction.Handler[scala.util.Try] = $anon$1@44a012ae
</span></code></pre>
</div>

<p>At this point, we can run our pure programs at the edge of the world.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">program</span><span class="o">[</span><span class="kt">Try</span><span class="o">]</span>
<span class="c1">// awesomesauce!
// res0: scala.util.Try[Unit] = Success(())
</span></code></pre>
</div>

<h2 id="stack-safety">Stack Safety</h2>

<p>Freestyle provides two strategies to make <code class="highlighter-rouge">@tagless</code> encoded algebras stack safe.</p>

<h3 id="interpreting-to-a-stack-safe-monad">Interpreting to a stack safe monad</h3>

<p>The handlers above are not stack safe because <code class="highlighter-rouge">Try</code> is not stack-safe. Luckily, we can rewrite our interpreters to 
interpret to <code class="highlighter-rouge">FreeS[Try, ?]</code> instead. This small penalty and a few extra allocations will make our programs stack safe.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">val</span> <span class="n">validationHandlerStackSafe</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Validation</span><span class="o">.</span><span class="nc">Handler</span><span class="o">[</span><span class="kt">FreeS</span><span class="o">[</span><span class="kt">Try</span>, <span class="kt">?</span><span class="o">]]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">minSize</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">FreeS</span><span class="o">[</span><span class="kt">Try</span>, <span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FreeS</span><span class="o">.</span><span class="n">liftFA</span><span class="o">(</span><span class="nc">Try</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="o">))</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">hasNumber</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FreeS</span><span class="o">[</span><span class="kt">Try</span>, <span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FreeS</span><span class="o">.</span><span class="n">liftFA</span><span class="o">(</span><span class="nc">Try</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">exists</span><span class="o">(</span><span class="n">c</span> <span class="k">=&gt;</span> <span class="s">"0123456789"</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="n">c</span><span class="o">))))</span>
<span class="o">}</span>
<span class="c1">// validationHandlerStackSafe: Validation.Handler[[β$0$]cats.free.Free[[β$0$]cats.free.FreeApplicative[scala.util.Try,β$0$],β$0$]] = $anon$1@3e7d03df
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">interactionHandlerStackSafe</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Interaction</span><span class="o">.</span><span class="nc">Handler</span><span class="o">[</span><span class="kt">FreeS</span><span class="o">[</span><span class="kt">Try</span>, <span class="kt">?</span><span class="o">]]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">tell</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FreeS</span><span class="o">[</span><span class="kt">Try</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FreeS</span><span class="o">.</span><span class="n">liftFA</span><span class="o">(</span><span class="nc">Try</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="o">)))</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">ask</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">FreeS</span><span class="o">[</span><span class="kt">Try</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FreeS</span><span class="o">.</span><span class="n">liftFA</span><span class="o">(</span><span class="nc">Try</span><span class="o">(</span><span class="s">"This could have been user input 1"</span><span class="o">))</span>
<span class="o">}</span>
<span class="c1">// interactionHandlerStackSafe: Interaction.Handler[[β$0$]cats.free.Free[[β$0$]cats.free.FreeApplicative[scala.util.Try,β$0$],β$0$]] = $anon$1@76f6f54f
</span></code></pre>
</div>

<p>We can now safely invoke our program in a stack safe way, running it to <code class="highlighter-rouge">Free[Try, ?]</code> first then to <code class="highlighter-rouge">Try</code>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">cats.arrow.FunctionK</span>
<span class="k">import</span> <span class="nn">cats.arrow.FunctionK</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">implicit</span> <span class="k">def</span> <span class="n">functionKIdentity</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span><span class="k">:</span> <span class="kt">FunctionK</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">F</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FunctionK</span><span class="o">.</span><span class="n">id</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span>
<span class="n">functionKIdentity</span><span class="k">:</span> <span class="err">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="err">]</span><span class="k">=&gt;</span> <span class="n">cats</span><span class="o">.</span><span class="n">arrow</span><span class="o">.</span><span class="nc">FunctionK</span><span class="o">[</span><span class="kt">F</span>,<span class="kt">F</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">program</span><span class="o">[</span><span class="kt">FreeS</span><span class="o">[</span><span class="kt">Try</span>, <span class="kt">?</span><span class="o">]].</span><span class="n">interpret</span><span class="o">[</span><span class="kt">Try</span><span class="o">]</span>
<span class="n">awesomesauce</span><span class="o">!</span>
<span class="n">res1</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(())</span>
</code></pre>
</div>

<h3 id="combining-tagless-and-free-algebras">Combining <code class="highlighter-rouge">@tagless</code> and <code class="highlighter-rouge">@free</code> algebras</h3>

<p>Freestyle comes with built in support to compose <code class="highlighter-rouge">@free</code> and <code class="highlighter-rouge">@tagless</code> algebras.</p>

<p>For every <code class="highlighter-rouge">@tagless</code> algebra, there is also a free-based representation that is stack-safe by nature, and that can be used
to lift <code class="highlighter-rouge">@tagless</code> algebras to the context of application where <code class="highlighter-rouge">@free</code> and <code class="highlighter-rouge">@tagless</code> algebras coexist.</p>

<p>Let’s redefine <code class="highlighter-rouge">program</code> to support <code class="highlighter-rouge">LoggingM</code> which is a <code class="highlighter-rouge">@free</code> defined algebra of logging operations:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">freestyle.logging._</span>
<span class="c1">// import freestyle.logging._
</span>
<span class="k">import</span> <span class="nn">freestyle.loggingJVM.implicits._</span>
<span class="c1">// import freestyle.loggingJVM.implicits._
</span>
<span class="k">def</span> <span class="n">program</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span>
   <span class="o">(</span><span class="k">implicit</span> <span class="n">log</span><span class="k">:</span> <span class="kt">LoggingM</span><span class="o">[</span><span class="kt">F</span><span class="o">],</span> 
             <span class="n">validation</span> <span class="k">:</span> <span class="kt">Validation.StackSafe</span><span class="o">[</span><span class="kt">F</span><span class="o">],</span> 
             <span class="n">interaction</span><span class="k">:</span> <span class="kt">Interaction.StackSafe</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>

  <span class="k">import</span> <span class="nn">cats.implicits._</span>

  <span class="k">for</span> <span class="o">{</span>
    <span class="n">userInput</span> <span class="k">&lt;-</span> <span class="n">interaction</span><span class="o">.</span><span class="n">ask</span><span class="o">(</span><span class="s">"Give me something with at least 3 chars and a number on it"</span><span class="o">)</span>
    <span class="n">valid</span> <span class="k">&lt;-</span> <span class="o">(</span><span class="n">validation</span><span class="o">.</span><span class="n">minSize</span><span class="o">(</span><span class="n">userInput</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span> <span class="o">|@|</span> <span class="n">validation</span><span class="o">.</span><span class="n">hasNumber</span><span class="o">(</span><span class="n">userInput</span><span class="o">)).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span> <span class="o">&amp;&amp;</span> <span class="k">_</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span>
            <span class="n">interaction</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="s">"awesomesauce!"</span><span class="o">)</span> 
         <span class="k">else</span>
            <span class="n">interaction</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="n">s</span><span class="s">"$userInput is not valid"</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">"Program finished"</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="o">()</span>
<span class="o">}</span>
<span class="c1">// program: [F[_]](implicit log: freestyle.logging.LoggingM[F], implicit validation: Validation.StackSafe[F], implicit interaction: Interaction.StackSafe[F])cats.free.Free[[β$0$]cats.free.FreeApplicative[F,β$0$],Unit]
</span></code></pre>
</div>

<p>Since <code class="highlighter-rouge">Validation</code> and <code class="highlighter-rouge">Interaction</code> were <code class="highlighter-rouge">@tagless</code> algebras, we need their <code class="highlighter-rouge">StackSafe</code> representation in order to combine
them with <code class="highlighter-rouge">@free</code> algebras.</p>

<h3 id="interpreting-combined-tagless-and-free-algebras">Interpreting combined <code class="highlighter-rouge">@tagless</code> and <code class="highlighter-rouge">@free</code> algebras</h3>

<p>When combining <code class="highlighter-rouge">@tagless</code> and <code class="highlighter-rouge">@free</code> algebras, we need all algebras to be considered in the final Coproduct we are interpreting to.
We can simply use tagless’s <code class="highlighter-rouge">.StackSafe</code> representation in modules so they are considered for the final Coproduct.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="nd">@module</span> <span class="k">trait</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">interaction</span><span class="k">:</span> <span class="kt">Interaction.StackSafe</span>
  <span class="k">val</span> <span class="n">validation</span><span class="k">:</span> <span class="kt">Validation.StackSafe</span>
  <span class="k">val</span> <span class="n">log</span><span class="k">:</span> <span class="kt">LoggingM</span>
<span class="o">}</span>
<span class="c1">// defined trait App
// defined object App
</span></code></pre>
</div>

<p>Once all of our algebras are considered, we can execute our programs</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">program</span><span class="o">[</span><span class="kt">App.Op</span><span class="o">].</span><span class="n">interpret</span><span class="o">[</span><span class="kt">Try</span><span class="o">]</span>
<span class="c1">// awesomesauce!
// res2: scala.util.Try[Unit] = Success(())
</span></code></pre>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/js/main.js"></script><script src="/js/kazari.js"></script><script>
$(document).ready(function() {
	kazari.KazariPlugin().decorateCode('https://scala-evaluator-212.herokuapp.com/eval', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.S2F6YXJp.Jl2eqMfw8IakJF93PjxTbrf-8YUJgX5OoOfy5JHE8Yw', '', 'solarized-dark')
})
    </script></body></html>